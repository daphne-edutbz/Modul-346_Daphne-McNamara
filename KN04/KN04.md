# KN04: Cloud-init und AWS

## A) Cloud-init Datei Verstehen (10%)

`cloud-init_documented.yaml` -> filename

## B) SSH-Key und Cloud-init (15%)

```bash
ssh-keygen -y -f "C:\Users\daphn\Downloads\Daphne1.pem" > "C:\Users\daphn\.ssh\Daphne1.pub"
ssh-keygen -y -f "C:\Users\daphn\Downloads\Daphne2.pem" > "C:\Users\daphn\.ssh\Daphne2.pub"
```
- `-y` -> generiert öffentlichen Key aus privaten Key


Verbindung über Key 1: 
<img width="847" height="401" alt="sshSchlüssel1" src="https://github.com/user-attachments/assets/4cd1bf55-d370-43ea-930e-3868ffbd4f32" />

(Verbindung funktioniert -> Key1 korrekt in Cloud-init)

Verbindung über Key2 
<img width="689" height="50" alt="sshSchlüssel2" src="https://github.com/user-attachments/assets/7dc2531d-30a1-4eb3-a149-44534213e31d" />

(muss fehlschlagen -> Key2 ist nicht in Cloud-init)


Key-Pair Einstellungen:
<img width="760" height="233" alt="detailsInstanz" src="https://github.com/user-attachments/assets/e0a4314d-a93c-4692-bd21-d07c44ede3e5" />
<img width="752" height="209" alt="detailsInstanz2" src="https://github.com/user-attachments/assets/6eb7a150-7db1-4890-9e4a-e6eb55346411" />



Auszug aus `/var/log/cloud-init-output.log`
<img width="794" height="437" alt="cloud-init-log" src="https://github.com/user-attachments/assets/0d4b36a0-2897-4c3f-b887-bcda97833c57" />


## C) Cloud-init Template (5%)

`cloud-init-template.yaml` -> filename


## D) Installation automatisieren (70%)


### DB-Server
Datei: `cloud-init-db.yaml`

1. MariaDB installieren -> über packages: Block in der Cloud-init-Datei

Ändern der Bind-Adresse:
<img width="643" height="49" alt="bindAddress" src="https://github.com/user-attachments/assets/100c91e7-fa1a-4f81-aff5-c1cdabb6b1cb" /> 

-> Damit externe Hosts (Webserver) auf DB zugreifen können.

### Webserver

Datei: `cloud-init-web.yaml`

1. Apache, PHP installieren → über packages: Block in der Cloud-init-Datei

2. Dateien erstellen: write_files: Block

index.html
<img width="955" height="530" alt="indexhtml" src="https://github.com/user-attachments/assets/f9cefe65-93a4-4da7-9600-bebfcd91b75a" />

info.php
<img width="959" height="536" alt="infophp" src="https://github.com/user-attachments/assets/b11714a8-1129-48f8-81b6-ec1ff479a720" />

db.php
<img width="956" height="530" alt="dbphp" src="https://github.com/user-attachments/assets/7a9666e3-80f4-4cf8-b462-a3c9d3e07379" />


3. Adminer -> DB-Verbindung zeigen

<img width="954" height="532" alt="Adminer" src="https://github.com/user-attachments/assets/6a5d4315-fe02-4d1d-8e19-e8a45ff67db8" />


## Leitfragen / Checkpoints

1. Ich kenne die YAML-Syntax und kann diese auch anwenden, speziell auch Listen und Verschachtelungen von Objekten

YAML = "Yet Another Markup Language/YAML Ain't Markup Language"
- Einrückung ist wichtig -> zeigen Verschachtelung an

2. Ich kenne die Grundstruktur von Cloud-Init Dateien und kann eine YAML Datei lesen

Datei sollte mit 

```yaml
#cloud-config
```

-> sagt dem System, dass es Cloud-init ist

Cloud-init besteht aus verschiedenen Blöcken, die bestimmte Aufgaben erledigen:
- Benutzer anlegen (users)
- Pakete installieren (packages)
- Dateien schreiben (write_files)
- Befehle ausführen (runcmd)
- SSH-Zugriff konfigurieren (ssh_authorized_keys)


3. Ich kenn die Cloud-Init Konfigurationsblöcke users, ssh_pwauth, disable_root, package_update, packages, write_files, runcmd, kann die Funktionsweise erklären und auch anwenden.


| Block            | Funktion                                | Beispiel                                |
| ---------------- | --------------------------------------- | --------------------------------------- |
| `users`          | Erstellt Benutzer mit Rechten           | `- name: ubuntu`                        |
| `ssh_pwauth`     | Aktiviert/Deaktiviert Passwort-Login    | `ssh_pwauth: false`                     |
| `disable_root`   | Root-Zugriff erlauben oder deaktivieren | `disable_root: false`                   |
| `package_update` | Paketliste aktualisieren                | `package_update: true`                  |
| `packages`       | Installiert Pakete automatisch          | `packages: [apache2, php]`              |
| `write_files`    | Schreibt Dateien auf die Instanz        | Pfad + Inhalt                           |
| `runcmd`         | Führt Befehle beim ersten Boot aus      | `runcmd: ["systemctl restart apache2"]` |




4. Ich kenne den Speicherort der Cloud-Init Logs und kann diese bei Fehler und Probleme lesen und interpretieren.


Log Datei: `/var/log/cloud-init-output.log`

Warum wichtig:
- Zeigt, welche Schritte erfolgreich waren
- Fehler beim Anlegen von Benutzern, Installieren von Paketen oder Ausführen von Befehlen werden hier protokolliert

Beispiel: Wenn Apache nicht startet, zeigt das Log die genaue Fehlermeldung.






